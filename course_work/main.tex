\documentclass[a4paper,14pt]{extarticle}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{listings}
\usepackage{hyperref}

\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{booktabs}
\usepackage{float}
\usepackage{subcaption}

\usepackage{xcolor}

\usepackage{indentfirst}
\usepackage[left = 20mm, right = 10mm, top = 20mm, bottom = 20mm]{geometry}
\usepackage[indent=1.25cm]{parskip}
\renewcommand{\baselinestretch}{1.5}


\newtheorem{theorem}{Теорема}
\newtheorem{lemma}{Лемма}
\newtheorem{definition}{Определение}

\theoremstyle{remark} % Стиль для утверждений и замечаний
\newtheorem{claim}{Утверждение}

\lstset{label=Листинг, tabsize = 2, basicstyle=\ttfamily, captionpos=b, escapeinside={№}{/№}}

\DeclareMathOperator*{\argmin}{arg\,min}

\author{Попов Илья}

\begin{document}

\begin{titlepage}
    \newpage
    \begin{center}
        Московский государственный университет имени M.В. Ломоносова
        Механико-математический факультет\\
        Кафедра вычислительной математики \\
    \end{center}

    \vspace{8em}

    \begin{center}
        \Large Курсовая работа \\
    \end{center}

    \vspace{2em}

    \begin{center}
        \textsc{\textbf{}}
    \end{center}

    \vspace{20em}

    \newbox{\lbox}
    \newlength{\maxl}
    \setlength{\maxl}{\wd\lbox}
    \hfill\parbox{13cm}{
        \hspace*{5cm}\hspace*{-5cm}Студент: \qquad\qquad\hbox to \maxl{Попов Илья Викторович\hfill}\\
        \hspace*{5cm}\hspace*{-5cm}Преподаватель: \hbox to \maxl{доц. Валединский Владимир Дмитриевич}\\
        \\
        \hspace*{5cm}\hspace*{-5cm}Группа:\qquad\qquad $\;\:$ \hbox to\maxl{310}\\
    }

    \vspace{\fill}

    \begin{center}
        Москва \\2025
    \end{center}

\end{titlepage}
\newpage


\title{Сравнение многогранников: оценка качества алгоритма построения объёмной модели трехмерного тела}
\date{\today}


\maketitle

\begin{abstract}
Работа включает в себя методы сравнения трёхмерных многогранников для оценки качества алгоритма построения трехмерной модели.
Предложена система метрик между гранями трехмерных многогранников для определения расстояние между ними и дальнейшего его использования в различных 
алгоритмах нахождения оптимального распределения : венгерский алгоритм и жадный алгоритм.
\end{abstract}

\section{Введение}

\subsection{Постановка проблемы}
Алгоритму необходимо получить число, которое характеризовало бы схожесть двух многогранников в некотором смысле.

\section{Математическая модель}
\subsection{Формальное описание многогранника}
Многогранник $P$ может быть задан в виде тройки:
\begin{equation}
P = (V, E, F), \text{ где:}
\end{equation}
\begin{itemize}
    \item $V = \{\mathbf{v}_i\} \subset \mathbb{R}^3$ — множество вершин
    \item $E = \{e_{ij}\}$ — множество рёбер
    \item $F = \{f_k\}$ — множество граней
\end{itemize}

Для каждой грани $f_k$ многогранника, определим eё основные характеристики:
\begin{itemize}
    \item Центр масс: $\mathbf{c}_k = \frac{1}{S_k} \sum\limits_{T \in \mathcal{T}_k} S_T \cdot \mathbf{c}_T$
    \noindent где:
    \begin{itemize}
        \item $\mathcal{T}_k$ -- множество треугольников триангуляции грани $f_k$ с помощью диагоналей
        \item $T$ -- отдельный треугольник в триангуляции (элемент $\mathcal{T}_k$)
        \item $S_T = \frac{1}{2}\|(\mathbf{v}_2 - \mathbf{v}_1) \times (\mathbf{v}_3 - \mathbf{v}_1)\|$ -- площадь треугольника $T$ 
            с вершинами $\mathbf{v}_1, \mathbf{v}_2, \mathbf{v}_3$
        \item $\mathbf{c}_T = \frac{1}{3}(\mathbf{v}_1 + \mathbf{v}_2 + \mathbf{v}_3)$ -- центр масс треугольника $T$
        \item $S_k = \sum_{T \in \mathcal{T}_k} S_T$ -- общая площадь грани $f_k$
    \end{itemize}
    \item Нормаль: $\mathbf{n}_k$ -- нормаль к плоскости, наилучшим образом приближающеё точки в смысле минимума суммы квадратов отклонений
\end{itemize}

\section{Метрики сравнения граней}
\begin{enumerate}
    \item Евклидово расстояние между центрами и евклидово расстояние между нормалями:
        \begin{equation}
            d(f,g) = \alpha \cdot \|\mathbf{c}_f - \mathbf{c}_g\|_2 + \beta \cdot \|\mathbf{n}_f - \mathbf{n}_g\|_2
        \end{equation}
        \noindent где:
        \begin{itemize}
            \item $\alpha, \beta$ - весовые коэффициенты
            \item $\alpha, \beta \in \mathbb{R}_{>0}$ - множество положительных действительных чисел
            \item $\|\mathbf{c}_f - \mathbf{c}_g\|_2$ - евклидово расстояние между центрами
            \item $\|\mathbf{n}_f - \mathbf{n}_g\|_2$ - евклидово расстояние между нормалями
        \end{itemize}

    \item Метрика на основе симметрической разности проекций:\newline
        Для граней $f$ и $g$ определим следующую метрику:
        \begin{equation}
            d(f,g) = \frac{S(A \triangle B)}{S(A) + S(B)}
        \end{equation}
        где:
        \begin{itemize}
            \item $H_{avg}$ -- усредненная плоскость между гранями

            \item $A = \text{proj}_{H_{avg}}(f)$ -- проекция грани $f$ на $H_{avg}$

            \item $B = \text{proj}_{H_{avg}}(g)$ -- проекция грани $g$ на $H_{avg}$

            \item $A \triangle B = (A \cup B) \setminus (A \cap B)$ -- симметрическая разность проекций

            \item $S(\cdot)$ -- площадь соответствующей проекции
        \end{itemize}

        Заметим, некоторые очевидые свойства этой метрики:
        \begin{itemize}
            \item $d_{sd} \in [0,1]$ (нормирована)
            \item $d_{sd} = 0$ при полном совпадении проекций
            \item $d_{sd} = 1$ при нулевом пересечении проекций
        \end{itemize}


    \item Метрика сравнения граней на основе хаусдорфова расстояния:
        Для двух компактных множеств $A,B \subset \mathbb{R}^2$ хаусдорфово расстояние определяется как:
        $d_H(A,B) = \max\left\{\sup_{a \in A} \inf_{b \in B} \|a - b\|, \sup_{b \in B} \inf_{a \in A} \|a - b\|\right\}$

        \begin{equation}
            d(f,g) = d_H(\text{proj}_{H_{avg}}(f), \text{proj}_{H_{avg}}(g))
        \end{equation}

\end{enumerate}

\section{Алгоритмы сопоставления}

Пусть заданы:
\begin{itemize}
    \item Многогранник $F_{\text{ref}}$ с гранями $\{f_i\}_{i=1}^n$
    \item Многогранник $G_{\text{rec}}$ с гранями $\{g_j\}_{j=1}^m$
    \item Метрика $d(f_i, g_j) \geq 0$ (соответствий тем лучше, чем меньше расстояние)
\end{itemize}

\subsection{Жадный алгоритм}
\subsubsection{Описание алгоритма}
\begin{enumerate}
    \item Инициализировать пустое множество соответствий $\phi = \emptyset$
    \item Пока есть не сопоставленные грани:
    \begin{enumerate}
        \item Для всех пар $(f_i, g_j)$ найти минимальное значение метрики:
            \[ (f^*, g^*) = \argmin_{f_i \in F_{\text{несоп.}}, g_j \in G_{\text{несоп.}}} d(f_i, g_j) \]
        \item Добавить соответствие в множество: $\phi \leftarrow \phi \cup \{f^* \leftrightarrow g^*\}$
        \item Удалить $f^*$ из $F_{\text{несоп.}}$, $g^*$ из $G_{\text{несоп.}}$
    \end{enumerate}
    \item Вернуть $\phi$
\end{enumerate}

\subsubsection{Особенности алгоритма}
Сложность:\newline
Пусть $m >= n$, тогда \newline
$\sum\limits_{i = 0}^{m - 1}(m - i) \cdot (n - i) = \sum\limits_{i = 0}^{m - 1}(m \cdot n - i \cdot m 
- i \cdot n + i^2) = O(m^2 \cdot n + \frac{1}{6} \cdot m^3)$\par
Не гарантирует глобально оптимальное соответствие


\subsection{Венгерский алгоритм}
Положим $N = \max \big\{ n, m \big\}$.
В рамках этого алгоритма ищется совершенное паросочетание минимальной стоимости в двудольном графе.
Вершины левой доли отвечают граням многогранника $F$, а правой - граням многогранника $G$.
Двудольный граф можно представить как матрицу $a[1...N][1...N]$, где $a[i][j] = d(f_i, g_j)$, то есть значение каждой ячеки матрицы - 
это вес соответствующего ребра в двудольном графе. Если  $n \neq m$, то незаполненные места в матрице заполняются
максимальным занчением метрики, ограниченной на множество граней сравниваемых многогранников.\par
\begin{definition}
Два массива $u[1 \ldots n]$ и $v[1 \ldots n]$ называются \textbf{потенциалом}, если:
\begin{equation*}
u[i] + v[j] \leq a[i][j] \quad \forall i,j = 1,\ldots,n
\end{equation*}
\end{definition}

\begin{definition}
    Ребро, соедениющее грани с номерами $i и j$ называется \textbf{жестким}, если: $u[i] + v[j] = a[i][j]$
\end{definition}

\begin{claim}
Заметим, что если есть решение, то есть совершенное паросочетание, использующее только жесткие ребра, то это паросочетание будет 
ответом на исходную минимализационную задачу.
\end{claim}
\begin{proof}[Обоснование]
    Пусть $sol$ - это суммарный вес всех ребер, входящих в  результирующее паросочетание.\newline
    Пусть нашлось соврешенной паросочетание - номер $1$ на жесткихх ребрах, тогда $\sum_{i = 1}^{N}u[i] + \sum_{j=1}^{N}v[j] = sol_{1}$
    , но любого другого паросочетание под номером $q$ имееем: $\sum_{i = 1}^{N}u[i] + \sum_{j=1}^{N}v[j] = sol_{q} \leq sol_{1}$
    ,  то есть этa сумма не меньше, но ровно стлоько уже есть.
\end{proof}

\subsubsection{Описание алгоритма}
Алгоритм будет изменять потенциалы таким образом, что бы нашлось совершенное паросочетание на жестких ребрах. Это корректно, благодаря
вышедоказанному утверждению.\par
Пусть $u$, $v$ - потенциалы, $M$ - паросочетание в графе жёстких рёбер $H = \{(i,j) | u[i]+v[j] = a[i][j]\}$
\begin{itemize}
    \item В начале алгоритма пологается что $u[i] = v[i] = 0 \quad \forall i = 1,\dots,n$ и $M = \emptyset$
    \item На каждом шаге алгоритма пытаемся увеличить мощность текущего паросочетания $M$ на еденицу. Для
        этого в графе $H$ оринтируем все ребра вправо, а ребра из паросочетания ориентируем в лево.
        Из новой ненасыщенной вершины левой доли ищем удлиняющую цепь, запуская dfs из неё, то есть обход в глубину. Если при этом  обходе дошли до 
        свободной вершины правой доли, то в этотм случае получали удлиняющую цепь, значит можем увеличить паросочетание. Иняче слудующий пункт.
    \item Если не дошли до какой-то свободной вершины правой доли. Обозначим $L$ - левую долю, $R$ - правую долю, $L^{+}, R^{+}$ -
        вершины, которые были достигнуты во время обхода, $L^{-}, R^{-}$ - вершины, которые не были достигнуты во время обхода.
        Положим $\Delta := \min \big\{a[i][j] - u[i] - v[j], i \in L^{+} ,j \in R^{-}\big\}$. Затем пересчитаем потенциалы следующим 
        образом: $$u[i] += \Delta,  i \in L^{+};$$ $$v[j] -= \Delta, j \in R^{+}$$
        При таком пересчете потенциалов не теряются жесткие ребра, участвовашие в предыдущем обходе, и появляется как минимум одно 
        новое жесткое ребро из $L^{+}$ в $R^{-}$. Пытаемся снова найти удлиняющую цепь. Таким образом при каждом слудующем dfs увеличивается
        число число вершин, которых достиг алгоритм.
\end{itemize}

\subsubsection{Особенности алгоритам}
Сложность: $n \cdot (n \cdot (dfs + n^2)) = O(n^4)$\par
Гарантируется глобально оптимальное соответствие.\par
Можно уменьшить сложность до $O(n^3)$ оптимизировав пересчет потенциалов и уменьшив количество поисков в глубину.

\section{Заключение}

Работа посвящена разработке методов сравнения трёхмерных многогранников. Были предложены метрики для срванения граней:
\begin{itemize}
    \item Комбинированная метрика на основе евклидовых расстояний между центрами масс и нормалями.
    \item Метрика симметрической разности проекций с нормированным расстоянием в диапазоне $[0, 1]$.
    \item Хаусдорфово расстояние между проекциями граней на усреднённую плоскость.
\end{itemize}
И описаны  алгоритмы для сопастовления граней двух многогранников:
\begin{itemize}
    \item Жадный алгоритм с вычислительной сложностью $O(n^3)$ для быстрого поиска локально оптимальных соответствий.
    \item Венгерский алгоритм, гарантирующий глобальный оптимум за $O(n^4)$, с возможностью оптимизации до $O(n^3)$.
\end{itemize}

В качестве меры схожести можно использовать максимальное расстояние между соответствующими гранями после оптимального сопоставления.
Формально:
\begin{equation}
    d(F, G) = \max_{(f_i, g_j) \in \phi} d(f_i, g_j),
\end{equation}
где $\phi$ — соответствие между гранями многогранников $F$ и $G$, а $d(f_i, g_j)$ — выбранная метрика расстояния между гранями
\end{document}

